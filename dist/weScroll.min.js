!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.WeScroll=i()}(this,function(){"use strict";function t(t,i,s,e){t.addEventListener(i,s,!!e)}function i(t,i,s,e){t.removeEventListener(i,s,!!e)}function s(t,i){var s=document.createEvent("Event");s.initEvent(i,!0,!0),t=t.changedTouches[0]||t,s.pageX=t.pageX,s.pageY=t.pageY,t.target.dispatchEvent(s)}var e=void 0;e="function"!=typeof Object.assign?function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),s=1;s<arguments.length;s++){var e=arguments[s];if(void 0!==e&&null!==e)for(var o in e)e.hasOwnProperty(o)&&(i[o]=e[o])}return i}:Object.assign;var o=e,n="ontouchstart"in window,r=!(!window.PointerEvent&&!window.MSPointerEvent),h={quadratic:function(t){return t*(2-t)},circular:function(t){return Math.sqrt(1- --t*t)},back:function(t){return(t-=1)*t*(5*t+4)+1},bounce:function(t){return(t/=1)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},elastic:function(t){return 0===t?0:1===t?1:.4*Math.pow(2,-10*t)*Math.sin((t-.055)*(2*Math.PI)/.22)+1}},a=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},c=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}(),d=function(){function t(){a(this,t),this._events=[]}return c(t,[{key:"on",value:function(t,i){this._events[t]||(this._events[t]=[]),this._events[t].push(i)}},{key:"off",value:function(t,i){if(this._events[t]){var s=this._events[t].indexOf(i);s>-1&&this._events[t].splice(s,1)}}},{key:"trigger",value:function(t){if(this._events[t]){var i=0,s=this._events[t].length;if(s)for(;i<s;i++)this._events[t][i].apply(this,[].slice.call(arguments,1))}}}]),t}(),u=function(t){for(var i=-t.offsetLeft,s=-t.offsetTop;t=t.offsetParent;)i-=t.offsetLeft,s-=t.offsetTop;return{left:i,top:s}},l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},p={zoomMin:1,zoomMax:4,startZoom:1,disablePointer:!r,disableTouch:r||!n,disableMouse:r||n,startX:0,startY:0,directionLockThreshold:5,bounce:!0,bounceTime:480,duration:300,preventDefault:!0,bindToWrapper:!0};return function(){function e(t,i){a(this,e),this.wrapper="string"==typeof t?document.querySelector(t):t,this.options=o({},p,i),this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,!0===this.options.tap&&(this.options.tap="tap"),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this.boundaryPadding=this.options.boundaryPadding||20,this.scale=Math.min(Math.max(this.options.startZoom,this.options.zoomMin),this.options.zoomMax),this._init(),this.refresh(),this._scrollTo(this.options.startX,this.options.startY),this.enable(),this._ticking=!1}return c(e,[{key:"_init",value:function(){this.observer=new d,this._initEvents()}},{key:"destroy",value:function(){this._initEvents(!0),clearTimeout(this.resizeTimeout),this.resizeTimeout=null,this.observer.trigger("destroy")}},{key:"_start",value:function(t){if(!this._ticking&&this.enabled){this.options.preventDefault&&t.preventDefault();var i=t.touches?t.touches[0]:t;this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this.startTime=Date.now(),this.isAnimating&&(this.isAnimating=!1,this.observer.trigger("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=i.pageX,this.pointY=i.pageY,this.observer.trigger("beforeScrollStart")}}},{key:"_move",value:function(t){if(this.enabled&&!this._ticking){this.options.preventDefault&&t.preventDefault();var i=t.touches?t.touches[0]:t,s=i.pageX-this.pointX,e=i.pageY-this.pointY,o=Date.now(),n=void 0,r=void 0,h=void 0,a=void 0;this.pointX=i.pageX,this.pointY=i.pageY,this.distX+=s,this.distY+=e,h=Math.abs(this.distX),a=Math.abs(this.distY),o-this.endTime>300&&h<10&&a<10||(this.directionLocked||(h>a+this.options.directionLockThreshold?this.directionLocked="h":a>=h+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"===this.directionLocked?e=0:"v"===this.directionLocked&&(s=0),n=this.x+s,r=this.y+e,(n>0||n<this.maxScrollX)&&(n=this.options.bounce?this.x+s/3:n>0?0:this.maxScrollX),(r>0||r<this.maxScrollY)&&(r=this.options.bounce?this.y+e/3:r>0?0:this.maxScrollY),this.directionX=s>0?-1:s<0?1:0,this.directionY=e>0?-1:e<0?1:0,this.moved||this.observer.trigger("scrollStart"),o-this.startTime>300&&(this.startTime=o,this.startX=this.x,this.startY=this.y),this._render(n,r),this.moved=!0)}}},{key:"_end",value:function(t){if(!this._ticking&&this.enabled){this.options.preventDefault&&t.preventDefault();var i=Math.round(this.x),e=Math.round(this.y),o="";if(this.endTime=Date.now(),!this._resetPosition(this.options.bounceTime))return this._scrollTo(i,e),this.moved?i!==this.x||e!==this.y?((i>this.boundaryPadding||i<this.maxScrollX||e>this.boundaryPadding||e<this.maxScrollY)&&(o=h.quadratic),void this._scrollTo(i,e,0,o)):void this.observer.trigger("scrollEnd"):(this.options.tap&&s(t,this.options.tap),void this.observer.trigger("scrollCancel"))}}},{key:"_resize",value:function(){var t=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){t.refresh()},this.options.resizePolling)}},{key:"_resetPosition",value:function(t){var i=this.x,s=this.y;return t=t||0,this.x>this.boundaryPadding?i=this.boundaryPadding:this.x<this.maxScrollX&&(i=this.maxScrollX),this.y>this.boundaryPadding?s=this.boundaryPadding:this.y<this.maxScrollY&&(s=this.maxScrollY),(i!==this.x||s!==this.y)&&(this._scrollTo(i,s,t,h.circular),!0)}},{key:"disable",value:function(){this.enabled=!1}},{key:"enable",value:function(){this.enabled=!0}},{key:"refresh",value:function(){this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=Math.round(this.options.contentWidth*this.scale),this.scrollerHeight=Math.round(this.options.contentHeight*this.scale),this.maxScrollX=this.wrapperWidth-this.scrollerWidth-this.boundaryPadding,this.maxScrollY=this.wrapperHeight-this.scrollerHeight-this.boundaryPadding,this.maxScrollY=Math.min(this.boundaryPadding,this.maxScrollY),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=u(this.wrapper),this.observer.trigger("refresh")}},{key:"_render",value:function(t,i){if(!this._ticking){var s=function(){this.options.render(t,i,this.scale),this.x=t,this.y=i,this._ticking=!1};if(!this._ticking){var e=s.bind(this);l(e),this._ticking=!0}}}},{key:"_zoomStart",value:function(t){var i=Math.abs(t.touches[0].pageX-t.touches[1].pageX),s=Math.abs(t.touches[0].pageY-t.touches[1].pageY);this.touchesDistanceStart=Math.sqrt(i*i+s*s),this.startScale=this.scale,this.originX=Math.abs(t.touches[0].pageX+t.touches[1].pageX)/2+this.wrapperOffset.left-this.x,this.originY=Math.abs(t.touches[0].pageY+t.touches[1].pageY)/2+this.wrapperOffset.top-this.y,this.observer.trigger("zoomStart")}},{key:"_zoom",value:function(t){if(this.enabled){this.options.preventDefault&&t.preventDefault();var i=Math.abs(t.touches[0].pageX-t.touches[1].pageX),s=Math.abs(t.touches[0].pageY-t.touches[1].pageY),e=Math.sqrt(i*i+s*s),o=1/this.touchesDistanceStart*e*this.startScale,n=void 0,r=void 0,h=void 0;this.scaled=!0,o<this.options.zoomMin?o=.5*this.options.zoomMin*Math.pow(2,o/this.options.zoomMin):o>this.options.zoomMax&&(o=2*this.options.zoomMax*Math.pow(.5,this.options.zoomMax/o)),n=o/this.startScale,r=this.originX-this.originX*n+this.startX,h=this.originY-this.originY*n+this.startY,this.scale=o,this._scrollTo(r,h,0)}}},{key:"_zoomEnd",value:function(t){if(this.enabled){this.options.preventDefault&&t.preventDefault();var i=void 0,s=void 0,e=void 0;this.initiated=0,this.scale>this.options.zoomMax?this.scale=this.options.zoomMax:this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin),this.refresh(),e=this.scale/this.startScale,i=this.originX-this.originX*e+this.startX,s=this.originY-this.originY*e+this.startY,i>this.boundaryPadding?i=this.boundaryPadding:i<this.maxScrollX&&(i=this.maxScrollX),s>this.boundaryPadding?s=this.boundaryPadding:s<this.maxScrollY&&(s=this.maxScrollY),this.x===i&&this.y===s||this._scrollTo(i,s,this.options.bounceTime),this.scaled=!1,this.observer.trigger("zoomEnd")}}},{key:"_getDestinationPosition",value:function(t,i){var s=void 0===t?this.scrollerWidth/2:t*this.scale,e=void 0===i?this.scrollerHeight/2:i*this.scale;return s=this.wrapperWidth/2-s,e=this.wrapperHeight/2-e,s>this.boundaryPadding?s=this.boundaryPadding:s<this.maxScrollX&&(e=this.maxScrollX),e>this.boundaryPadding?e=this.boundaryPadding:e<this.maxScrollY&&(e=this.maxScrollY),{x:s,y:e}}},{key:"_animate",value:function(t,i,s,e){function o(){var d=Date.now(),u=void 0,p=void 0,v=void 0;if(d>=c)return n.isAnimating=!1,void n._render(t,i);d=(d-a)/s,v=e(d),u=(t-r)*v+r,p=(i-h)*v+h,n._render(u,p),n.isAnimating&&l(o)}var n=this,r=this.x,h=this.y,a=Date.now(),c=a+s;this.isAnimating=!0,o()}},{key:"_scrollTo",value:function(t,i,s,e){e=e||h.circular,s?this._animate(t,i,s,e):this._render(t,i)}},{key:"scrollTo",value:function(t,i,s,e){s=void 0===s?this.options.duration:s,e=e||h.circular,t=-t*this.scale+this.wrapperWidth/2,i=-i*this.scale+this.wrapperHeight/2,t>this.boundaryPadding?t=this.boundaryPadding:t<this.maxScrollX&&(t=this.maxScrollX),i>this.boundaryPadding?i=this.boundaryPadding:i<this.maxScrollY&&(i=this.maxScrollY),this._scrollTo(t,i,s,e)}},{key:"zoom",value:function(t,i,s,e){function o(){var h=Date.now(),u=void 0,p=void 0,v=void 0,f=void 0;if(h>=c)return n.isAnimating=!1,n.scale=t,n.refresh(),v=n._getDestinationPosition(i,s),void n._render(v.x,v.y);h=(h-a)/e,f=d(h),p=(t-r)*f+r,n.scale=p,n.refresh(),u=n._getDestinationPosition(i,s),n._render(u.x,u.y),n.isAnimating&&l(o)}if(t<this.options.zoomMin?t=this.options.zoomMin:t>this.options.zoomMax&&(t=this.options.zoomMax),t!==this.scale){e=void 0===e?300:e;var n=this,r=n.scale,a=Date.now(),c=a+e,d=h.circular;this.isAnimating=!0,o()}}},{key:"_initEvents",value:function(s){var e=s?i:t,o=this.options.bindToWrapper?this.wrapper:window,r=this._handleEvent.bind(this);if(e(window,"resize",r),this.options.click&&e(this.wrapper,"click",r,!0),!this.options.disableMouse){e(this.wrapper,"mousedown",r);["mousemove","mousecancel","mouseup"].forEach(function(t){e(o,t,r)})}if(n&&!this.options.disableTouch){e(this.wrapper,"touchstart",r);["touchmove","touchcancel","touchend"].forEach(function(t){e(o,t,r)})}}},{key:"_handleEvent",value:function(t){switch(t.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(t),this.options.zoom&&t.touches&&t.touches.length>1&&this._zoomStart(t);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":if(this.options.zoom&&t.touches&&t.touches[1])return void this._zoom(t);this._move(t);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":if(this.scaled)return void this._zoomEnd(t);this._end(t);break;case"orientationchange":case"resize":this._resize()}}}]),e}()});
