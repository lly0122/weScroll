!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.weRender=t.weRender||{})}(this,function(t){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(){function t(i){e(this,t),this._rendered=!1,this._init(i),this.width=this.canvas.width,this.height=this.canvas.height}return i(t,[{key:"_initMethods",value:function(){var t=this;[].concat(["clearRect","fillRect","strokeRect"],["fillText","strokeText","measureText"],["lineWidth","lineCap","lineJoin"],["font","textAlgin","textBaseline","direction"],["fillStyle","strokeStyle"],["beginPath","closePath","moveTo","lineTo","arc","arcTo","rect"],["fill","stroke"],["rotate","scale","translate","transform","resetTransform"],["drawImage"],["createImageData","getImageData","putImageData"],["save","restore"],arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,i){return e[i]||(t._proxy(i),e[i]=!0),e},{})}},{key:"_init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.canvas,i=t.actions,n=t.width,a=t.height,s=t.x,h=t.y,r=t.methods;this.canvas=e||document.createElement("canvas"),this._ctx=this.canvas.getContext("2d"),this._initMethods(r),this.setSize(n,a),this.setCoordinate(s,h),this.setActions(i)}},{key:"_proxy",value:function(t){var e=this,i=this._ctx[t],n=null;i&&(n="[object Function]"===Object.prototype.toString.call(i)?function(){for(var i=arguments.length,n=Array(i),a=0;a<i;a++)n[a]=arguments[a];return e._actions.push({type:"function",method:t,args:n}),e}:function(i){return e._actions.push({type:"value",method:t,args:i}),e},this[t]=n)}},{key:"setSize",value:function(t,e){return t&&t!==this.width&&(this.canvas.width=t,this.width=t),e&&e!==this.height&&(this.canvas.height=e,this.height=e),this}},{key:"setStyle",value:function(t,e){return t&&(this.canvas.style.width=t),e&&(this.canvas.style.height=e),this}},{key:"setCoordinate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t,this.y=e,this}},{key:"clear",value:function(){this._ctx.clearRect(0,0,this.width,this.height),this.setActions([])}},{key:"getActions",value:function(){return this._actions}},{key:"setActions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Array.isArray(t)&&(this._actions=t)}},{key:"draw",value:function(){var t=this;if(!(this._rendered&&this._cache||!this._actions.length))return this._actions.forEach(function(e){var i=e.type,n=e.method,a=e.args;"function"===i?t._ctx[n].apply(t._ctx,a):t._ctx[n]=a}),this._rendered||(this._rendered=!0),this}},{key:"cache",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return"boolean"==typeof t&&(this._cache=t),this}}]),t}(),a=function(){function t(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this._canvas=new n({canvas:i}).cache(!1),this._children=[],this._updating=!1,this._init(a)}return i(t,[{key:"_initOptions",value:function(t){var e=t.clear,i=void 0===e||e,n=t.ratio,a=void 0===n?1:n;"boolean"==typeof i&&(this._clear=i),"number"==typeof a&&(this._ratio=a)}},{key:"_init",value:function(t){this._initOptions(t);var e=this._canvas,i=e.width,a=e.height;this._offScreenCanvas=new n({width:i,height:a}).cache(!1)}},{key:"setSize",value:function(t,e){this._canvas.setSize(t,e),this._offScreenCanvas.setSize(t,e)}},{key:"setStyle",value:function(t,e){this._canvas.setStyle(t,e)}},{key:"destory",value:function(){this._canvas=null,this._offScreenCanvas=null,this._children=[]}},{key:"clear",value:function(){this._offScreenCanvas.clear(),this._canvas.clear()}},{key:"addChild",value:function(t){(t instanceof n||t.canvas.getContext("2d"))&&this._children.push(t)}},{key:"translate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"number"==typeof t&&"number"==typeof e&&(this._coordinate={x:t,y:e}),"boolean"==typeof i&&(this._translateReset=i)}},{key:"update",value:function(){this._children.length&&!this._updating&&(this._updating=!0,this._clear&&this.clear(),this._translateStage(),this._drawChildren(),this._resetCoordinate(),this._offScreenCanvas.draw(),this._updateStage(),this._updating=!1,this._children=[])}},{key:"_translateStage",value:function(){if(this._coordinate){var t=this._coordinate,e=t.x,i=t.y;this._offScreenCanvas.translate(e,i)}}},{key:"_resetCoordinate",value:function(){if(this._translateReset){var t=this._coordinate,e=t.x,i=t.y;this._offScreenCanvas.translate(-e,-i),this._coordinate=null}}},{key:"_drawChildren",value:function(){var t=this;this._children.forEach(function(e){e instanceof n?t._drawChild(e):t._drawChildCanvas(e)})}},{key:"_drawChild",value:function(t){var e=t.canvas,i=t.x,n=t.y,a=t.width,s=t.height;t.draw(),this._offScreenCanvas.drawImage(e,i,n,a/this._ratio,s/this._ratio)}},{key:"_drawChildCanvas",value:function(t){var e=t.x,i=void 0===e?0:e,n=t.y,a=void 0===n?0:n,s=t.canvas;this._offScreenCanvas.drawImage(s,i,a,s.width/this._ratio,s.height/this._ratio)}},{key:"_updateStage",value:function(){this._canvas.drawImage(this._offScreenCanvas.canvas,0,0),this._canvas.draw()}}]),t}();t.WeCanvas=n,t.WeStage=a,Object.defineProperty(t,"__esModule",{value:!0})});
