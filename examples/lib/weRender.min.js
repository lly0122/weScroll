!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.weRender=t.weRender||{})}(this,function(t){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},s=function(){function t(t,e){var i=[],n=!0,a=!1,s=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done)&&(i.push(r.value),!e||i.length!==e);n=!0);}catch(t){a=!0,s=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw s}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function t(){e(this,t),this._actions=[]}return i(t,[{key:"getActions",value:function(){return this._actions}},{key:"setActions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Array.isArray(t)&&(this._actions=t)}},{key:"clearRect",value:function(){return this._actions.push(["method","clearRect",arguments]),this}},{key:"fillRect",value:function(){return this._actions.push(["method","fillRect",arguments]),this}},{key:"strokeRect",value:function(){return this._actions.push(["method","strokeRect",arguments]),this}},{key:"fillText",value:function(){return this._actions.push(["method","fillText",arguments]),this}},{key:"strokeText",value:function(){return this._actions.push(["method","strokeText",arguments]),this}},{key:"measureText",value:function(){return this._actions.push(["method","measureText",arguments]),this}},{key:"lineWidth",value:function(){return this._actions.push(["property","lineWidth",arguments]),this}},{key:"lineCap",value:function(){return this._actions.push(["property","lineCap",arguments]),this}},{key:"lineJoin",value:function(){return this._actions.push(["property","lineJoin",arguments]),this}},{key:"font",value:function(){return this._actions.push(["property","font",arguments]),this}},{key:"textBaseline",value:function(){return this._actions.push(["property","textBaseline",arguments]),this}},{key:"fillStyle",value:function(){return this._actions.push(["property","fillStyle",arguments]),this}},{key:"strokeStyle",value:function(){return this._actions.push(["property","strokeStyle",arguments]),this}},{key:"beginPath",value:function(){return this._actions.push(["method","beginPath",arguments]),this}},{key:"closePath",value:function(){return this._actions.push(["method","closePath",arguments]),this}},{key:"moveTo",value:function(){return this._actions.push(["method","moveTo",arguments]),this}},{key:"lineTo",value:function(){return this._actions.push(["method","lineTo",arguments]),this}},{key:"bezierCurveTo",value:function(){return this._actions.push(["method","bezierCurveTo",arguments]),this}},{key:"quadraticCurveTo",value:function(){return this._actions.push(["method","quadraticCurveTo",arguments]),this}},{key:"arc",value:function(){return this._actions.push(["method","arc",arguments]),this}},{key:"arcTo",value:function(){return this._actions.push(["method","arcTo",arguments]),this}},{key:"rect",value:function(){return this._actions.push(["method","rect",arguments]),this}},{key:"fill",value:function(){return this._actions.push(["method","fill",arguments]),this}},{key:"stroke",value:function(){return this._actions.push(["method","stroke",arguments]),this}},{key:"rotate",value:function(){return this._actions.push(["method","rotate",arguments]),this}},{key:"scale",value:function(){return this._actions.push(["method","scale",arguments]),this}},{key:"translate",value:function(){return this._actions.push(["method","translate",arguments]),this}},{key:"transform",value:function(){return this._actions.push(["method","transform",arguments]),this}},{key:"resetTransform",value:function(){return this._actions.push(["method","resetTransform",arguments]),this}},{key:"drawImage",value:function(){return this._actions.push(["method","drawImage",arguments]),this}},{key:"createImageData",value:function(){return this._actions.push(["method","createImageData",arguments]),this}},{key:"getImageData",value:function(){return this._actions.push(["method","getImageData",arguments]),this}},{key:"putImageData",value:function(){return this._actions.push(["method","putImageData",arguments]),this}},{key:"save",value:function(){return this._actions.push(["method","save",arguments]),this}},{key:"restore",value:function(){return this._actions.push(["method","restore",arguments]),this}},{key:"shadowColor",value:function(){return this._actions.push(["property","shadowColor",arguments]),this}},{key:"shadowBlur",value:function(){return this._actions.push(["property","shadowBlur",arguments]),this}}]),t}(),o=function(t){function r(t){e(this,r);var i=a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return i._rendered=!1,i._init(t),i.width=i.canvas.width,i.height=i.canvas.height,i}return n(r,t),i(r,[{key:"_init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.canvas,i=t.actions,n=t.width,a=t.height,s=t.x,r=t.y,o=t.methods;this.canvas=e||document.createElement("canvas"),this._ctx=this.canvas.getContext("2d"),this._initMethods(o),this.setSize(n,a),this.setCoordinate(s,r),this.setActions(i)}},{key:"_initMethods",value:function(){var t=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,i){return t[i]||(t._proxy(i),e[i]=!0),e},{})}},{key:"_proxy",value:function(t){var e=this,i=this._ctx[t];void 0!==i&&(this[t]=function(){for(var n=arguments.length,a=Array(n),s=0;s<n;s++)a[s]=arguments[s];return e._actions.push(["[object Function]"===Object.prototype.toString.call(i)?"method":"property",t,a]),e})}},{key:"setSize",value:function(t,e){return t&&t!==this.width&&(this.canvas.width=t,this.width=t),e&&e!==this.height&&(this.canvas.height=e,this.height=e),this}},{key:"setStyle",value:function(t,e){return t&&(this.canvas.style.width=t),e&&(this.canvas.style.height=e),this}},{key:"setCoordinate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t,this.y=e,this}},{key:"setScale",value:function(t){this._ctx.scale(t,t)}},{key:"clear",value:function(){this._ctx.clearRect(0,0,this.width,this.height),this.setActions([])}},{key:"draw",value:function(){var t=this;if(!(this._rendered&&this._cache||!this._actions.length))return this._actions.forEach(function(e){var i=s(e,3),n=i[0],a=i[1],r=i[2],o=Array.prototype.slice.call(r);"method"===n?t._ctx[a].apply(t._ctx,o):t._ctx[a]=o[0]}),this._rendered||(this._rendered=!0),this}},{key:"cache",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return"boolean"==typeof t&&(this._cache=t),this}}]),r}(r),h=function(){function t(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this._canvas=new o({canvas:i}).cache(!1),this._children=[],this._updating=!1,this._init(n)}return i(t,[{key:"_initOptions",value:function(t){var e=t.clear,i=void 0===e||e,n=t.ratio,a=void 0===n?1:n;"boolean"==typeof i&&(this._clear=i),"number"==typeof a&&(this._ratio=a)}},{key:"_init",value:function(t){this._initOptions(t);var e=this._canvas,i=e.width,n=e.height;this._offScreenCanvas=new o({width:i,height:n}).cache(!1)}},{key:"setSize",value:function(t,e){this._canvas.setSize(t,e),this._offScreenCanvas.setSize(t,e),this._offScreenCanvas.setScale(this._ratio)}},{key:"setStyle",value:function(t,e){this._canvas.setStyle(t,e)}},{key:"destory",value:function(){this._canvas=null,this._offScreenCanvas=null,this._children=[]}},{key:"clear",value:function(){this._offScreenCanvas.clear(),this._canvas.clear()}},{key:"addChild",value:function(t){(t instanceof o||t.canvas.getContext("2d"))&&this._children.push(t)}},{key:"translate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"number"==typeof t&&"number"==typeof e&&(this._coordinate={x:t,y:e}),"boolean"==typeof i&&(this._translateReset=i)}},{key:"update",value:function(){this._children.length&&!this._updating&&(this._updating=!0,this._clear&&this.clear(),this._translateStage(),this._drawChildren(),this._resetCoordinate(),this._offScreenCanvas.draw(),this._updateStage(),this._updating=!1,this._children=[])}},{key:"_translateStage",value:function(){if(this._coordinate){var t=this._coordinate,e=t.x,i=t.y;this._offScreenCanvas.translate(e,i)}}},{key:"_resetCoordinate",value:function(){if(this._translateReset){var t=this._coordinate,e=t.x,i=t.y;this._offScreenCanvas.translate(-e,-i),this._coordinate=null}}},{key:"_drawChildren",value:function(){var t=this;this._children.forEach(function(e){e instanceof o?t._drawChild(e):t._drawChildCanvas(e)})}},{key:"_drawChild",value:function(t){var e=t.canvas,i=t.x,n=t.y,a=t.width,s=t.height;t.draw(),this._offScreenCanvas.drawImage(e,i,n,a/this._ratio,s/this._ratio)}},{key:"_drawChildCanvas",value:function(t){var e=t.x,i=void 0===e?0:e,n=t.y,a=void 0===n?0:n,s=t.canvas;this._offScreenCanvas.drawImage(s,i,a,s.width/this._ratio,s.height/this._ratio)}},{key:"_updateStage",value:function(){this._canvas.drawImage(this._offScreenCanvas.canvas,0,0),this._canvas.draw()}}]),t}();t.WeCanvas=o,t.WeStage=h,Object.defineProperty(t,"__esModule",{value:!0})});
