!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.weRender=t.weRender||{})}(this,function(t){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(){function t(t,e){var i=[],n=!0,a=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){a=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(i){e(this,t),this._rendered=!1,this._init(i),this.width=this.canvas.width,this.height=this.canvas.height}return i(t,null,[{key:"generatorMethod",value:function(){return t.hasGeneratored=!0,[].concat(["clearRect","fillRect","strokeRect"],["fillText","strokeText","measureText"],["lineWidth","lineCap","lineJoin"],["font","textAlgin","textBaseline","direction"],["fillStyle","strokeStyle"],["beginPath","closePath","moveTo","lineTo","bezierCurveTo","quadraticCurveTo","arc","arcTo","rect"],["fill","stroke"],["rotate","scale","translate","transform","resetTransform"],["drawImage"],["createImageData","getImageData","putImageData"],["save","restore"],["shadowColor","shadowBlur"])}}]),i(t,[{key:"_init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.canvas,n=e.actions,a=e.width,r=e.height,s=e.x,o=e.y,h=e.methods,c=void 0===h?[]:h;this.canvas=i||document.createElement("canvas"),this._ctx=this.canvas.getContext("2d"),this._initMethods(t.hasGeneratored?c:t.generatorMethod().concat(c)),this.setSize(a,r),this.setCoordinate(s,o),this.setActions(n)}},{key:"_initMethods",value:function(){var t=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,i){return t[i]||(t._proxy(i),e[i]=!0),e},{})}},{key:"_proxy",value:function(e){var i=this._ctx[e];void 0!==i&&(t.prototype[e]=function(){for(var t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];return this._actions.push(["[object Function]"===Object.prototype.toString.call(i)?"method":"property",e,n]),this})}},{key:"setSize",value:function(t,e){return t&&t!==this.width&&(this.canvas.width=t,this.width=t),e&&e!==this.height&&(this.canvas.height=e,this.height=e),this}},{key:"setStyle",value:function(t,e){return t&&(this.canvas.style.width=t),e&&(this.canvas.style.height=e),this}},{key:"setCoordinate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t,this.y=e,this}},{key:"setScale",value:function(t){this._ctx.scale(t,t)}},{key:"clear",value:function(){this._ctx.clearRect(0,0,this.width,this.height),this.setActions([])}},{key:"getActions",value:function(){return this._actions}},{key:"setActions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Array.isArray(t)&&(this._actions=t)}},{key:"draw",value:function(){var t=this;if(!(this._rendered&&this._cache||!this._actions.length))return this._actions.forEach(function(e){var i=n(e,3),a=i[0],r=i[1],s=i[2],o=Array.prototype.slice.call(s);"method"===a?t._ctx[r].apply(t._ctx,o):t._ctx[r]=o[0]}),this._rendered||(this._rendered=!0),this}},{key:"cache",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return"boolean"==typeof t&&(this._cache=t),this}}]),t}();a.hasGeneratored=!1;var r=function(){function t(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this._canvas=new a({canvas:i}).cache(!1),this._children=[],this._updating=!1,this._initOptions(n)}return i(t,[{key:"_initOptions",value:function(t){var e=t.clear,i=void 0===e||e,n=t.ratio,a=void 0===n?1:n;"boolean"==typeof i&&(this._clear=i),"number"==typeof a&&(this._ratio=a)}},{key:"setSize",value:function(t,e){this._canvas.setSize(t,e),this._canvas.setScale(this._ratio)}},{key:"setStyle",value:function(t,e){this._canvas.setStyle(t,e)}},{key:"destory",value:function(){this._canvas=null,this._children.length=0}},{key:"clear",value:function(){this._canvas.clear()}},{key:"addChild",value:function(t){(t instanceof a||t.canvas.getContext("2d"))&&this._children.push(t)}},{key:"translate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"number"==typeof t&&"number"==typeof e&&(this._coordinate={x:t,y:e}),"boolean"==typeof i&&(this._translateReset=i)}},{key:"update",value:function(){this._children.length&&!this._updating&&(this._updating=!0,this._clear&&this.clear(),this._translateStage(),this._drawChildren(),this._resetCoordinate(),this._updateStage(),this._updating=!1,this._children=[])}},{key:"_translateStage",value:function(){if(this._coordinate){var t=this._coordinate,e=t.x,i=t.y;this._canvas.translate(e,i)}}},{key:"_resetCoordinate",value:function(){if(this._translateReset){var t=this._coordinate,e=t.x,i=t.y;this._canvas.translate(-e,-i),this._coordinate=null}}},{key:"_drawChildren",value:function(){var t=this;this._children.forEach(function(e){e instanceof a?t._drawChild(e):t._drawChildCanvas(e)})}},{key:"_drawChild",value:function(t){var e=t.canvas,i=t.x,n=t.y,a=t.width,r=t.height;t.draw(),this._canvas.drawImage(e,i,n,a/this._ratio,r/this._ratio)}},{key:"_drawChildCanvas",value:function(t){var e=t.x,i=void 0===e?0:e,n=t.y,a=void 0===n?0:n,r=t.canvas;this._canvas.drawImage(r,i,a,r.width/this._ratio,r.height/this._ratio)}},{key:"_updateStage",value:function(){this._canvas.draw()}}]),t}();t.WeCanvas=a,t.WeStage=r,Object.defineProperty(t,"__esModule",{value:!0})});
